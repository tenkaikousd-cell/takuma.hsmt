<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒè‘‰çœŒå…¬ç«‹é«˜æ ¡å—é¨“å¯¾ç­–ãƒ†ã‚­ã‚¹ãƒˆè‡ªå‹•åˆ¤å®š</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 42px;
            font-weight: 900;
            margin: 0 0 10px 0;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 18px;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            animation: slideUp 0.6s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 900;
            color: #2d3748;
            margin: 0 0 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: #2d3748;
            font-size: 14px;
        }
        
        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .score-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .score-item {
            background: linear-gradient(135deg, #f6f8fb 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 12px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .score-item:focus-within {
            border-color: #667eea;
            background: white;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .stats-number {
            font-size: 48px;
            font-weight: 900;
            margin: 10px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            padding: 20px;
            border-radius: 16px;
            color: white;
            text-align: center;
        }
        
        .stat-box.green {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .stat-box.pink {
            background: linear-gradient(135deg, #ed64a6 0%, #d53f8c 100%);
        }
        
        .stat-box.blue {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        }
        
        .school-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            display: inline-block;
            margin: 5px;
        }
        
        .textbook-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
            cursor: pointer;
            user-select: none;
        }
        
        .textbook-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .textbook-detail {
            background: #f7fafc;
            padding: 16px;
            border-radius: 12px;
            margin-top: -8px;
            margin-bottom: 12px;
            border-left: 4px solid #4299e1;
            animation: slideDown 0.3s ease-out;
        }
        
        .subject-section {
            margin-bottom: 30px;
        }
        
        .subject-title {
            font-size: 20px;
            font-weight: 900;
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-area {
            display: block;
        }
        
        .form-area.hidden {
            display: none;
        }
        
        .error-message {
            color: #e53e3e;
            font-size: 14px;
            font-weight: 700;
            margin-top: 5px;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        .input-field.error {
            border-color: #e53e3e;
            background-color: #fff5f5;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>åƒè‘‰çœŒå…¬ç«‹é«˜æ ¡å—é¨“å¯¾ç­–ãƒ†ã‚­ã‚¹ãƒˆè‡ªå‹•åˆ¤å®š</h1>
            <p>ç”Ÿå¾’ã®æˆç¸¾ã‹ã‚‰æœ€é©ãªãƒ†ã‚­ã‚¹ãƒˆã‚’ææ¡ˆã—ã¾ã™</p>
        </div>

        <form id="mainForm" class="form-area">
            <!-- ç”Ÿå¾’åå…¥åŠ› -->
            <div class="card">
                <h2 class="section-title">ğŸ‘¤ ç”Ÿå¾’æƒ…å ±</h2>
                
                <div class="input-group">
                    <label class="input-label">ç”Ÿå¾’å</label>
                    <input type="text" class="input-field" id="studentName" placeholder="ä¾‹ï¼šå±±ç”°å¤ªéƒ" required>
                </div>
            </div>

            <!-- Sã‚‚ãåå·®å€¤å…¥åŠ› -->
            <div class="card">
                <h2 class="section-title">ğŸ“– Sã‚‚ãåå·®å€¤å…¥åŠ›</h2>
                
                <div class="score-grid">
                    <div class="score-item">
                        <label class="input-label">è‹±èª</label>
                        <input type="number" class="input-field score-input" id="english" placeholder="åå·®å€¤" min="0" max="100">
                    </div>
                    <div class="score-item">
                        <label class="input-label">æ•°å­¦</label>
                        <input type="number" class="input-field score-input" id="math" placeholder="åå·®å€¤" min="0" max="100">
                    </div>
                    <div class="score-item">
                        <label class="input-label">å›½èª</label>
                        <input type="number" class="input-field score-input" id="japanese" placeholder="åå·®å€¤" min="0" max="100">
                    </div>
                    <div class="score-item">
                        <label class="input-label">ç†ç§‘</label>
                        <input type="number" class="input-field score-input" id="science" placeholder="åå·®å€¤" min="0" max="100">
                    </div>
                    <div class="score-item">
                        <label class="input-label">ç¤¾ä¼š</label>
                        <input type="number" class="input-field score-input" id="social" placeholder="åå·®å€¤" min="0" max="100">
                    </div>
                </div>
            </div>

            <!-- 5æ•™ç§‘åå·®å€¤å…¥åŠ› -->
            <div class="card">
                <h2 class="section-title">ğŸ“Š 5æ•™ç§‘ç·åˆåå·®å€¤</h2>
                
                <div class="input-group">
                    <label class="input-label">5æ•™ç§‘ç·åˆåå·®å€¤ï¼ˆæ¨¡è©¦çµæœï¼‰</label>
                    <input type="number" class="input-field score-input" id="fiveSubjectHensachi" placeholder="5æ•™ç§‘ç·åˆåå·®å€¤" min="0" max="100">
                </div>
            </div>

            <!-- å†…ç”³ç‚¹å…¥åŠ› -->
            <div class="card">
                <h2 class="section-title">ğŸ“ˆ å†…ç”³ç‚¹å…¥åŠ›</h2>
                
                <div class="score-grid">
                    <div class="score-item">
                        <label class="input-label">1å¹´ç”Ÿï¼ˆ9æ•™ç§‘åˆè¨ˆï¼‰</label>
                        <input type="number" class="input-field naishin-input" id="grade1" placeholder="45ç‚¹æº€ç‚¹" min="0" max="45">
                    </div>
                    <div class="score-item">
                        <label class="input-label">2å¹´ç”Ÿï¼ˆ9æ•™ç§‘åˆè¨ˆï¼‰</label>
                        <input type="number" class="input-field naishin-input" id="grade2" placeholder="45ç‚¹æº€ç‚¹" min="0" max="45">
                    </div>
                    <div class="score-item">
                        <label class="input-label">3å¹´ç”Ÿï¼ˆ9æ•™ç§‘åˆè¨ˆï¼‰</label>
                        <input type="number" class="input-field naishin-input" id="grade3" placeholder="45ç‚¹æº€ç‚¹" min="0" max="45">
                    </div>
                </div>

                <div id="naishinDisplay" class="stats-card hidden">
                    <div style="font-size: 16px; opacity: 0.9;">å†…ç”³ç‚¹åˆè¨ˆ</div>
                    <div class="stats-number" id="totalNaishin">0</div>
                    <div style="font-size: 14px; opacity: 0.9;">/ 135ç‚¹æº€ç‚¹</div>
                </div>
            </div>

            <!-- å¿—æœ›æ ¡é¸æŠ -->
            <div class="card">
                <h2 class="section-title">ğŸ« å¿—æœ›æ ¡é¸æŠ</h2>
                
                <div class="input-group">
                    <label class="input-label">å­¦ç§‘ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
                    <select class="input-field" id="schoolType" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="normal">æ™®é€šç§‘</option>
                        <option value="specialized">å°‚é–€å­¦ç§‘ãƒ»ãã®ä»–</option>
                    </select>
                </div>

                <div id="districtSelect" class="input-group hidden">
                    <label class="input-label">ã‚ãªãŸã®å­¦åŒºã‚’é¸æŠã—ã¦ãã ã•ã„</label>
                    <select class="input-field" id="studentDistrict" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="1">ç¬¬1å­¦åŒºï¼ˆåƒè‘‰å¸‚ï¼‰</option>
                        <option value="2">ç¬¬2å­¦åŒºï¼ˆå¸‚å·å¸‚ã€èˆ¹æ©‹å¸‚ã€æ¾æˆ¸å¸‚ã€ç¿’å¿—é‡å¸‚ã€å…«åƒä»£å¸‚ã€æµ¦å®‰å¸‚ï¼‰</option>
                        <option value="3">ç¬¬3å­¦åŒºï¼ˆé‡ç”°å¸‚ã€æŸå¸‚ã€æµå±±å¸‚ã€æˆ‘å­«å­å¸‚ã€éŒã‚±è°·å¸‚ï¼‰</option>
                        <option value="4">ç¬¬4å­¦åŒºï¼ˆæˆç”°å¸‚ã€ä½å€‰å¸‚ã€å››è¡—é“å¸‚ã€å…«è¡—å¸‚ã€å°è¥¿å¸‚ã€ç™½äº•å¸‚ã€å¯Œé‡Œå¸‚ã€å°æ—›éƒ¡ï¼‰</option>
                        <option value="5">ç¬¬5å­¦åŒºï¼ˆéŠšå­å¸‚ã€æ—­å¸‚ã€åŒç‘³å¸‚ã€é¦™å–å¸‚ã€é¦™å–éƒ¡ï¼‰</option>
                        <option value="6">ç¬¬6å­¦åŒºï¼ˆæ±é‡‘å¸‚ã€å±±æ­¦å¸‚ã€å¤§ç¶²ç™½é‡Œå¸‚ã€å±±æ­¦éƒ¡ï¼‰</option>
                        <option value="7">ç¬¬7å­¦åŒºï¼ˆèŒ‚åŸå¸‚ã€å‹æµ¦å¸‚ã€ã„ã™ã¿å¸‚ã€é•·ç”Ÿéƒ¡ã€å¤·éš…éƒ¡ï¼‰</option>
                        <option value="8">ç¬¬8å­¦åŒºï¼ˆé¤¨å±±å¸‚ã€é´¨å·å¸‚ã€å—æˆ¿ç·å¸‚ã€å®‰æˆ¿éƒ¡ï¼‰</option>
                        <option value="9">ç¬¬9å­¦åŒºï¼ˆæœ¨æ›´æ´¥å¸‚ã€å¸‚åŸå¸‚ã€å›æ´¥å¸‚ã€å¯Œæ´¥å¸‚ã€è¢–ã‚±æµ¦å¸‚ï¼‰</option>
                    </select>
                </div>

                <div id="schoolSelect" class="input-group hidden">
                    <label class="input-label">å¿—æœ›æ ¡ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
                    <select class="input-field" id="targetSchool" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>

                <button type="submit" class="btn-primary">
                    ğŸ“Š æ¨å¥¨ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
                </button>
            </div>
        </form>

        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="resultsArea" class="hidden">
            <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
            <div class="card">
                <button type="button" class="btn-primary" onclick="backToForm()" style="background: linear-gradient(135deg, #718096 0%, #4a5568 100%);">
                    â† å…¥åŠ›ç”»é¢ã«æˆ»ã‚‹
                </button>
            </div>

            <!-- Excelå‡ºåŠ›ãƒœã‚¿ãƒ³ -->
            <div class="card">
                <button type="button" class="btn-primary" onclick="exportToExcel()" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">
                    ğŸ“Š çµæœã‚’Excelã§å‡ºåŠ›
                </button>
            </div>

            <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
            <div class="card">
                <h2 class="section-title">ğŸ“Š ã‚ãªãŸã®ç¾åœ¨åœ°ã¨ç›®æ¨™</h2>
                <div class="stats-grid">
                    <div class="stat-box green">
                        <div style="font-size: 14px; opacity: 0.9;">ç¾åœ¨ã®å¹³å‡åå·®å€¤</div>
                        <div style="font-size: 36px; font-weight: 900; margin: 10px 0;" id="currentHensachi">0</div>
                        <div style="font-size: 12px;">Sã‚‚ã</div>
                    </div>
                    <div class="stat-box pink">
                        <div style="font-size: 14px; opacity: 0.9;">ç›®æ¨™åå·®å€¤</div>
                        <div style="font-size: 36px; font-weight: 900; margin: 10px 0;" id="targetHensachi">0</div>
                        <div style="font-size: 12px;" id="targetSchoolName"></div>
                    </div>
                    <div class="stat-box blue">
                        <div style="font-size: 14px; opacity: 0.9;">å¿…è¦ãªä¸Šæ˜‡å¹…</div>
                        <div style="font-size: 36px; font-weight: 900; margin: 10px 0;" id="gapHensachi">0</div>
                        <div style="font-size: 12px;">ãƒã‚¤ãƒ³ãƒˆ</div>
                    </div>
                </div>
            </div>

            <!-- åå·®å€¤Â±3ã®é«˜æ ¡ -->
            <div id="nearbySchoolsCard" class="card hidden">
                <h2 class="section-title">ğŸ« ç¾åœ¨ã®åå·®å€¤ã§ç‹™ãˆã‚‹é«˜æ ¡ï¼ˆÂ±3ä»¥å†…ï¼‰</h2>
                <div id="nearbySchoolsList"></div>
            </div>

            <!-- æ¨å¥¨ãƒ†ã‚­ã‚¹ãƒˆ -->
            <div class="card">
                <h2 class="section-title">ğŸ“š æ¨å¥¨ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ•™ç§‘åˆ¥ï¼‰</h2>
                <div id="textbooksList"></div>
            </div>
        </div>
    </div>

    <script>
        // åƒè‘‰çœŒå…¬ç«‹é«˜æ ¡ãƒ‡ãƒ¼ã‚¿
        const chibaHighSchools = {
            district1: {
                æ™®é€šç§‘: [
                    { name: 'çœŒç«‹åƒè‘‰é«˜æ ¡', hensachi: 70, district: 1 },
                    { name: 'çœŒç«‹åƒè‘‰æ±é«˜æ ¡', hensachi: 68, district: 1 },
                    { name: 'å¸‚ç«‹åƒè‘‰é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 66, district: 1 },
                    { name: 'çœŒç«‹å¹•å¼µç·åˆé«˜æ ¡ï¼ˆç·åˆå­¦ç§‘ï¼‰', hensachi: 60, district: 1 },
                    { name: 'çœŒç«‹åƒè‘‰è¥¿é«˜æ ¡', hensachi: 60, district: 1 },
                    { name: 'çœŒç«‹æ¤œè¦‹å·é«˜æ ¡', hensachi: 58, district: 1 },
                    { name: 'çœŒç«‹åƒè‘‰å¥³å­é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 55, district: 1 },
                    { name: 'çœŒç«‹åƒè‘‰å—é«˜æ ¡', hensachi: 55, district: 1 },
                    { name: 'çœŒç«‹ç£¯è¾ºé«˜æ ¡', hensachi: 54, district: 1 },
                    { name: 'çœŒç«‹åƒè‘‰åŒ—é«˜æ ¡', hensachi: 53, district: 1 },
                    { name: 'çœŒç«‹åƒåŸå°é«˜æ ¡', hensachi: 48, district: 1 },
                    { name: 'çœŒç«‹è‹¥æ¾é«˜æ ¡', hensachi: 45, district: 1 },
                    { name: 'çœŒç«‹åœŸæ°—é«˜æ ¡', hensachi: 44, district: 1 },
                    { name: 'çœŒç«‹æŸäº•é«˜æ ¡', hensachi: 43, district: 1 },
                    { name: 'çœŒç«‹ç”Ÿæµœé«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 40, district: 1 },
                    { name: 'çœŒç«‹çŠ¢æ©‹é«˜æ ¡', hensachi: 37, district: 1 },
                    { name: 'çœŒç«‹æ³‰é«˜æ ¡', hensachi: 35, district: 1 }
                ]
            },
            district2: {
                æ™®é€šç§‘: [
                    { name: 'çœŒç«‹èˆ¹æ©‹é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 70, district: 2 },
                    { name: 'çœŒç«‹èˆ¹æ©‹é«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 69, district: 2 },
                    { name: 'çœŒç«‹è–¬åœ’å°é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 66, district: 2 },
                    { name: 'çœŒç«‹å°é‡‘é«˜æ ¡ï¼ˆç·åˆå­¦ç§‘ï¼‰', hensachi: 66, district: 2 },
                    { name: 'çœŒç«‹èˆ¹æ©‹æ±é«˜æ ¡', hensachi: 64, district: 2 },
                    { name: 'çœŒç«‹å…«åƒä»£é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 62, district: 2 },
                    { name: 'çœŒç«‹å›½åºœå°é«˜æ ¡', hensachi: 60, district: 2 },
                    { name: 'çœŒç«‹æ´¥ç”°æ²¼é«˜æ ¡', hensachi: 58, district: 2 },
                    { name: 'çœŒç«‹æ¾æˆ¸å›½éš›é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 58, district: 2 },
                    { name: 'çœŒç«‹å›½åˆ†é«˜æ ¡', hensachi: 57, district: 2 },
                    { name: 'çœŒç«‹æ¾æˆ¸å›½éš›é«˜æ ¡ï¼ˆå›½éš›æ•™é¤Šç§‘ï¼‰', hensachi: 56, district: 2 },
                    { name: 'çœŒç«‹èˆ¹æ©‹èŠå±±é«˜æ ¡', hensachi: 54, district: 2 },
                    { name: 'çœŒç«‹å¸‚å·æ±é«˜æ ¡', hensachi: 53, district: 2 },
                    { name: 'å¸‚ç«‹æ¾æˆ¸é«˜æ ¡ï¼ˆå›½éš›äººæ–‡ç§‘ï¼‰', hensachi: 53, district: 2 },
                    { name: 'å¸‚ç«‹ç¿’å¿—é‡é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 52, district: 2 },
                    { name: 'çœŒç«‹èˆ¹æ©‹å•“æ˜é«˜æ ¡', hensachi: 51, district: 2 },
                    { name: 'å¸‚ç«‹æ¾æˆ¸é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 51, district: 2 },
                    { name: 'çœŒç«‹æ¾æˆ¸é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 50, district: 2 },
                    { name: 'å¸‚ç«‹èˆ¹æ©‹é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 50, district: 2 },
                    { name: 'çœŒç«‹æ¾æˆ¸å…­å®Ÿé«˜æ ¡', hensachi: 49, district: 2 },
                    { name: 'çœŒç«‹å¸‚å·æ˜´é«˜æ ¡', hensachi: 47, district: 2 },
                    { name: 'çœŒç«‹å®Ÿç±¾é«˜æ ¡', hensachi: 47, district: 2 },
                    { name: 'çœŒç«‹æ¾æˆ¸é¦¬æ©‹é«˜æ ¡', hensachi: 42, district: 2 },
                    { name: 'çœŒç«‹èˆ¹æ©‹äºŒå’Œé«˜æ ¡', hensachi: 41, district: 2 },
                    { name: 'çœŒç«‹å…«åƒä»£æ±é«˜æ ¡', hensachi: 41, district: 2 },
                    { name: 'çœŒç«‹å¸‚å·å—é«˜æ ¡', hensachi: 40, district: 2 },
                    { name: 'çœŒç«‹èˆ¹æ©‹æ³•å…¸é«˜æ ¡', hensachi: 37, district: 2 },
                    { name: 'çœŒç«‹æµ¦å®‰é«˜æ ¡', hensachi: 37, district: 2 },
                    { name: 'çœŒç«‹æ¾æˆ¸å‘é™½é«˜æ ¡', hensachi: 37, district: 2 },
                    { name: 'çœŒç«‹èˆ¹æ©‹åŒ—é«˜æ ¡', hensachi: 36, district: 2 },
                    { name: 'çœŒç«‹èˆ¹æ©‹å¤å’Œé‡œé«˜æ ¡', hensachi: 35, district: 2 },
                    { name: 'çœŒç«‹å…«åƒä»£è¥¿é«˜æ ¡', hensachi: 35, district: 2 },
                    { name: 'çœŒç«‹èˆ¹æ©‹è±Šå¯Œé«˜æ ¡', hensachi: 35, district: 2 },
                    { name: 'çœŒç«‹è¡Œå¾³é«˜æ ¡', hensachi: 35, district: 2 },
                    { name: 'çœŒç«‹æµ¦å®‰å—é«˜æ ¡', hensachi: 35, district: 2 }
                ]
            },
            district3: {
                æ™®é€šç§‘: [
                    { name: 'çœŒç«‹æ±è‘›é£¾é«˜æ ¡', hensachi: 69, district: 3 },
                    { name: 'çœŒç«‹æŸé«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 64, district: 3 },
                    { name: 'çœŒç«‹æŸé«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 62, district: 3 },
                    { name: 'çœŒç«‹éŒãƒ¶è°·é«˜æ ¡', hensachi: 61, district: 3 },
                    { name: 'çœŒç«‹æŸå—é«˜æ ¡', hensachi: 61, district: 3 },
                    { name: 'çœŒç«‹æŸä¸­å¤®é«˜æ ¡', hensachi: 57, district: 3 },
                    { name: 'çœŒç«‹æŸã®è‘‰é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 57, district: 3 },
                    { name: 'çœŒç«‹æŸã®è‘‰é«˜æ ¡ï¼ˆæƒ…å ±ç†æ•°ç§‘ï¼‰', hensachi: 57, district: 3 },
                    { name: 'çœŒç«‹æµå±±ãŠãŠãŸã‹ã®æ£®é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 51, district: 3 },
                    { name: 'çœŒç«‹æˆ‘å­«å­é«˜æ ¡', hensachi: 51, district: 3 },
                    { name: 'çœŒç«‹æµå±±ãŠãŠãŸã‹ã®æ£®é«˜æ ¡ï¼ˆå›½éš›ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç§‘ï¼‰', hensachi: 50, district: 3 },
                    { name: 'çœŒç«‹æŸé™µé«˜æ ¡', hensachi: 47, district: 3 },
                    { name: 'å¸‚ç«‹æŸé«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 45, district: 3 },
                    { name: 'çœŒç«‹é‡ç”°ä¸­å¤®é«˜æ ¡', hensachi: 43, district: 3 },
                    { name: 'çœŒç«‹æµå±±å—é«˜æ ¡', hensachi: 38, district: 3 },
                    { name: 'çœŒç«‹æ²¼å—é«˜æŸ³é«˜æ ¡', hensachi: 37, district: 3 },
                    { name: 'çœŒç«‹éŒãƒ¶è°·è¥¿é«˜æ ¡', hensachi: 35, district: 3 },
                    { name: 'çœŒç«‹æ²¼å—é«˜æ ¡', hensachi: 35, district: 3 },
                    { name: 'çœŒç«‹æµå±±åŒ—é«˜æ ¡', hensachi: 35, district: 3 },
                    { name: 'çœŒç«‹æˆ‘å­«å­æ±é«˜æ ¡', hensachi: 35, district: 3 },
                    { name: 'çœŒç«‹é–¢å®¿é«˜æ ¡', hensachi: 35, district: 3 }
                ]
            },
            district4: {
                æ™®é€šç§‘: [
                    { name: 'çœŒç«‹ä½å€‰é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 67, district: 4 },
                    { name: 'çœŒç«‹ä½å€‰é«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 65, district: 4 },
                    { name: 'çœŒç«‹æˆç”°å›½éš›é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 61, district: 4 },
                    { name: 'çœŒç«‹æˆç”°å›½éš›é«˜æ ¡ï¼ˆå›½éš›ç§‘ï¼‰', hensachi: 59, district: 4 },
                    { name: 'çœŒç«‹ä½å€‰æ±é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 45, district: 4 },
                    { name: 'çœŒç«‹æˆç”°åŒ—é«˜æ ¡', hensachi: 49, district: 4 },
                    { name: 'çœŒç«‹å››è¡—é“é«˜æ ¡', hensachi: 51, district: 4 },
                    { name: 'çœŒç«‹å°æ—›æ˜èª é«˜æ ¡', hensachi: 49, district: 4 },
                    { name: 'çœŒç«‹å››è¡—é“åŒ—é«˜æ ¡', hensachi: 41, district: 4 },
                    { name: 'çœŒç«‹å°è¦‹å·é«˜æ ¡', hensachi: 42, district: 4 },
                    { name: 'çœŒç«‹å¯Œé‡Œé«˜æ ¡', hensachi: 41, district: 4 },
                    { name: 'çœŒç«‹ç™½äº•é«˜æ ¡', hensachi: 41, district: 4 },
                    { name: 'çœŒç«‹å¤šå¤é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 37, district: 4 },
                    { name: 'çœŒç«‹ä½å€‰è¥¿é«˜æ ¡', hensachi: 37, district: 4 },
                    { name: 'çœŒç«‹å…«è¡—é«˜æ ¡ï¼ˆç·åˆå­¦ç§‘ï¼‰', hensachi: 36, district: 4 },
                    { name: 'çœŒç«‹ä½å€‰å—é«˜æ ¡', hensachi: 35, district: 4 }
                ]
            },
            district5: {
                æ™®é€šç§‘: [
                    { name: 'çœŒç«‹ä½åŸé«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 60, district: 5 },
                    { name: 'çœŒç«‹ä½åŸé«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 56, district: 5 },
                    { name: 'çœŒç«‹åŒç‘³é«˜æ ¡ï¼ˆç·åˆå­¦ç§‘ï¼‰', hensachi: 50, district: 5 },
                    { name: 'çœŒç«‹éŠšå­é«˜æ ¡', hensachi: 45, district: 5 }
                ]
            },
            district6: {
                æ™®é€šç§‘: [
                    { name: 'å¸‚ç«‹éŠšå­é«˜æ ¡ï¼ˆæ™®é€šç§‘ãƒ»ç†æ•°ç§‘ï¼‰', hensachi: 54, district: 6 },
                    { name: 'çœŒç«‹æˆæ±é«˜æ ¡ï¼ˆæ™®é€šç§‘ãƒ»ç†æ•°ç§‘ï¼‰', hensachi: 58, district: 6 },
                    { name: 'çœŒç«‹æ±é‡‘é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 52, district: 6 },
                    { name: 'çœŒç«‹æ±é‡‘é«˜æ ¡ï¼ˆå›½éš›æ•™é¤Šç§‘ï¼‰', hensachi: 50, district: 6 },
                    { name: 'çœŒç«‹å¤§ç¶²é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 38, district: 6 },
                    { name: 'çœŒç«‹æ¾å°¾é«˜æ ¡', hensachi: 41, district: 6 },
                    { name: 'çœŒç«‹ä¹åä¹é‡Œé«˜æ ¡', hensachi: 35, district: 6 }
                ]
            },
            district7: {
                æ™®é€šç§‘: [
                    { name: 'çœŒç«‹é•·ç”Ÿé«˜æ ¡ï¼ˆæ™®é€šç§‘ãƒ»ç†æ•°ç§‘ï¼‰', hensachi: 63, district: 7 },
                    { name: 'çœŒç«‹èŒ‚åŸé«˜æ ¡', hensachi: 50, district: 7 },
                    { name: 'çœŒç«‹å¤§å¤šå–œé«˜æ ¡', hensachi: 45, district: 7 },
                    { name: 'çœŒç«‹å¤§åŸé«˜æ ¡ï¼ˆç·åˆå­¦ç§‘ï¼‰', hensachi: 36, district: 7 }
                ]
            },
            district8: {
                æ™®é€šç§‘: [
                    { name: 'çœŒç«‹å®‰æˆ¿é«˜æ ¡', hensachi: 53, district: 8 },
                    { name: 'çœŒç«‹é•·ç‹­é«˜æ ¡', hensachi: 45, district: 8 },
                    { name: 'çœŒç«‹å®‰æˆ¿æ‹“å¿ƒé«˜æ ¡ï¼ˆç·åˆå­¦ç§‘ï¼‰', hensachi: 39, district: 8 }
                ]
            },
            district9: {
                æ™®é€šç§‘: [
                    { name: 'çœŒç«‹æœ¨æ›´æ´¥é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 63, district: 9 },
                    { name: 'çœŒç«‹æœ¨æ›´æ´¥é«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 60, district: 9 },
                    { name: 'çœŒç«‹å›æ´¥é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 53, district: 9 },
                    { name: 'çœŒç«‹è¢–ãƒ¶æµ¦é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 48, district: 9 },
                    { name: 'çœŒç«‹è¢–ãƒ¶æµ¦é«˜æ ¡ï¼ˆæƒ…å ±ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç§‘ï¼‰', hensachi: 47, district: 9 },
                    { name: 'çœŒç«‹å¸‚åŸå…«å¹¡é«˜æ ¡', hensachi: 44, district: 9 },
                    { name: 'çœŒç«‹æœ¨æ›´æ´¥æ±é«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 42, district: 9 },
                    { name: 'çœŒç«‹å§‰å´é«˜æ ¡', hensachi: 40, district: 9 },
                    { name: 'çœŒç«‹äº¬è‘‰é«˜æ ¡', hensachi: 40, district: 9 },
                    { name: 'çœŒç«‹å¸‚åŸç·‘é«˜æ ¡', hensachi: 37, district: 9 },
                    { name: 'çœŒç«‹å¤©ç¾½é«˜æ ¡', hensachi: 35, district: 9 },
                    { name: 'çœŒç«‹å¸‚åŸé«˜æ ¡ï¼ˆæ™®é€šç§‘ï¼‰', hensachi: 35, district: 9 },
                    { name: 'çœŒç«‹å›æ´¥é’è‘‰é«˜æ ¡ï¼ˆç·åˆå­¦ç§‘ï¼‰', hensachi: 35, district: 9 }
                ]
            },
            specialized: [
                { name: 'çœŒç«‹åƒè‘‰é«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 70, type: 'ç†æ•°ç§‘' },
                { name: 'å¸‚ç«‹åƒè‘‰é«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 66, type: 'ç†æ•°ç§‘' },
                { name: 'çœŒç«‹èˆ¹æ©‹é«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 69, type: 'ç†æ•°ç§‘' },
                { name: 'çœŒç«‹æŸé«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 62, type: 'ç†æ•°ç§‘' },
                { name: 'çœŒç«‹ä½å€‰é«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 65, type: 'ç†æ•°ç§‘' },
                { name: 'çœŒç«‹æœ¨æ›´æ´¥é«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 60, type: 'ç†æ•°ç§‘' },
                { name: 'çœŒç«‹é•·ç”Ÿé«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 63, type: 'ç†æ•°ç§‘' },
                { name: 'çœŒç«‹ä½åŸé«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 56, type: 'ç†æ•°ç§‘' },
                { name: 'çœŒç«‹æˆæ±é«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 58, type: 'ç†æ•°ç§‘' },
                { name: 'å¸‚ç«‹éŠšå­é«˜æ ¡ï¼ˆç†æ•°ç§‘ï¼‰', hensachi: 54, type: 'ç†æ•°ç§‘' },
                { name: 'çœŒç«‹å¹•å¼µç·åˆé«˜æ ¡ï¼ˆçœ‹è­·ç§‘ï¼‰', hensachi: 60, type: 'çœ‹è­·ç§‘' },
                { name: 'çœŒç«‹åƒè‘‰å¥³å­é«˜æ ¡ï¼ˆå®¶æ”¿ç§‘ï¼‰', hensachi: 55, type: 'å®¶æ”¿ç§‘' },
                { name: 'çœŒç«‹æœ¨æ›´æ´¥æ±é«˜æ ¡ï¼ˆå®¶æ”¿ç§‘ï¼‰', hensachi: 42, type: 'å®¶æ”¿ç§‘' },
                { name: 'çœŒç«‹åƒè‘‰å·¥æ¥­é«˜æ ¡ï¼ˆæƒ…å ±æŠ€è¡“ç§‘ï¼‰', hensachi: 53, type: 'å·¥æ¥­ç§‘' },
                { name: 'çœŒç«‹åƒè‘‰å·¥æ¥­é«˜æ ¡ï¼ˆç†æ•°å·¥å­¦ç§‘ï¼‰', hensachi: 53, type: 'å·¥æ¥­ç§‘' },
                { name: 'çœŒç«‹å¸‚å·å·¥æ¥­é«˜æ ¡', hensachi: 47, type: 'å·¥æ¥­ç§‘' },
                { name: 'çœŒç«‹åƒè‘‰å•†æ¥­é«˜æ ¡ï¼ˆå•†æ¥­ç§‘ãƒ»æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ ç§‘ï¼‰', hensachi: 51, type: 'å•†æ¥­ç§‘' },
                { name: 'å¸‚ç«‹èˆ¹æ©‹é«˜æ ¡ï¼ˆå•†æ¥­ç§‘ï¼‰', hensachi: 50, type: 'å•†æ¥­ç§‘' },
                { name: 'å¸‚ç«‹ç¿’å¿—é‡é«˜æ ¡ï¼ˆå•†æ¥­ç§‘ï¼‰', hensachi: 52, type: 'å•†æ¥­ç§‘' },
                { name: 'çœŒç«‹æˆç”°å›½éš›é«˜æ ¡ï¼ˆå›½éš›ç§‘ï¼‰', hensachi: 59, type: 'å›½éš›ç§‘' },
                { name: 'çœŒç«‹æ¾æˆ¸å›½éš›é«˜æ ¡ï¼ˆå›½éš›æ•™é¤Šç§‘ï¼‰', hensachi: 56, type: 'å›½éš›ç§‘' },
                { name: 'å¸‚ç«‹æ¾æˆ¸é«˜æ ¡ï¼ˆå›½éš›äººæ–‡ç§‘ï¼‰', hensachi: 53, type: 'å›½éš›ç§‘' },
                { name: 'çœŒç«‹æ±é‡‘é«˜æ ¡ï¼ˆå›½éš›æ•™é¤Šç§‘ï¼‰', hensachi: 50, type: 'å›½éš›ç§‘' },
                { name: 'çœŒç«‹æµå±±ãŠãŠãŸã‹ã®æ£®é«˜æ ¡ï¼ˆå›½éš›ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç§‘ï¼‰', hensachi: 50, type: 'å›½éš›ç§‘' },
                { name: 'å¸‚ç«‹èˆ¹æ©‹é«˜æ ¡ï¼ˆä½“è‚²ç§‘ï¼‰', hensachi: 50, type: 'ä½“è‚²ç§‘' },
                { name: 'çœŒç«‹å…«åƒä»£é«˜æ ¡ï¼ˆä½“è‚²ç§‘ï¼‰', hensachi: 53, type: 'ä½“è‚²ç§‘' },
                { name: 'å¸‚ç«‹æŸé«˜æ ¡ï¼ˆã‚¹ãƒãƒ¼ãƒ„ç§‘å­¦ç§‘ï¼‰', hensachi: 45, type: 'ä½“è‚²ç§‘' }
            ]
        };

        // å­¦åŒºã®éš£æ¥é–¢ä¿‚
        const adjacentDistricts = {
            1: [2, 4, 6, 7, 9],
            2: [1, 3, 4],
            3: [2, 4],
            4: [1, 2, 3, 5, 6],
            5: [4, 6],
            6: [1, 4, 5, 7],
            7: [1, 6, 8, 9],
            8: [7, 9],
            9: [1, 7, 8]
        };

        // æ¨å¥¨ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
        const textbookRules = {
            'è‹±èª': [
                {
                    condition: (current, target) => current < 50 && target <= 50,
                    books: [
                        { name: 'ãƒ•ã‚©ãƒ¬ã‚¹ã‚¿è‹±å˜èª', publisher: 'ã‚¹ãƒ—ãƒªãƒƒã‚¯ã‚¹', reason: 'å˜èªé‡ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚1é€±ç›®ã®å˜èªã®å’Œè¨³ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„' },
                        { name: 'ã‚¦ã‚§ã‚¤ãƒ»ã‚¢ãƒƒãƒ— é«˜æ ¡å…¥è©¦å¯¾ç­–', publisher: 'ã‚¨ãƒ‡ãƒ¥ã‚±ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', reason: 'åŸºç¤ãƒ¬ãƒ™ãƒ«ã‚’ç¶²ç¾…çš„ã«å­¦ç¿’ã§ãã¾ã™ã€‚äºˆæƒ³å•é¡Œã‚„éå»å•å‰ã®ãƒ†ã‚­ã‚¹ãƒˆã«æœ€é©ã§ã™' },
                        { name: 'ãƒ•ã‚©ãƒ¬ã‚¹ã‚¿ã‚¹ãƒ†ãƒƒãƒ—', publisher: 'ã‚¹ãƒ—ãƒªãƒƒã‚¯ã‚¹', reason: 'åŸºç¤çš„ãªæ–‡æ³•ç†è§£ã‚’ç›®æŒ‡ã™ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚' },
                        { name: 'è‹±èªèª­è§£C', publisher: 'æ•™è‚²é–‹ç™ºå‡ºç‰ˆ', reason: 'æ–‡æ³•ã®ä¸¸æš—è¨˜ã‹ã‚‰å®Ÿè·µå‹ã«ç§»ã™ãŸã‚ã®ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚åŒç¤¾ã®è‹±ä½œæ–‡Cã‚‚ä½µç”¨ã™ã‚‹ã¨ã€åŠ¹æœãŒå¤§ãã„ã§ã™ã€‚' },
                        { name: 'å¿…å‹ã‚·ãƒªãƒ¼ã‚ºåƒè‘‰çœŒç‰ˆ', publisher: 'æ—¥æœ¬æ•™æå‡ºç‰ˆ', reason: 'å„æ•™ç§‘ã”ã¨ã«ã‚ã‚Šã¾ã™ã€‚éå»å•ã®å‰ã«æ¼”ç¿’ã‚’è¡Œã†ã“ã¨ã§ã€éå»å•ã¸ã®å…ç–«ã‚’ã¤ã‘ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚' }
                    ]
                },
                {
                    condition: (current, target) => current <= 100 && target <= 100,
                    books: [
                        { name: 'ãƒªã‚¹ãƒ‹ãƒ³ã‚°C', publisher: 'ã‚¨ãƒ‡ãƒ¥ã‚±ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', reason: 'ä¸­3é…å½“ã®æ–‡æ³•ã‚’ä½¿ç”¨ã—ãŸãƒªã‚¹ãƒ‹ãƒ³ã‚°é›†ã§ã™ã€‚å—é¨“ç”¨ã«äºˆæƒ³å•é¡Œã®ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã§ã¯åˆ†é‡ãŒå°‘ãªã„ã®ã§ã€ä½µç”¨ã—ã¦ãã ã•ã„' }
                    ]
                },
                {
                    condition: (current, target) =>  target > 50,
                    books: [
                        { name: 'ãƒ•ã‚©ãƒ¬ã‚¹ã‚¿è‹±å˜èª', publisher: 'ã‚¹ãƒ—ãƒªãƒƒã‚¯ã‚¹', reason: '2é€±ç›®ã®å˜èªã®è‹±è¨³ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„' },
                        { name: 'ãƒ•ã‚©ãƒ¬ã‚¹ã‚¿ã‚´ãƒ¼ãƒ«', publisher: 'ã‚¹ãƒ—ãƒªãƒƒã‚¯ã‚¹', reason: 'å˜èªåŠ›ãŒã‚ã‚Šã€åŸºç¤çš„ãªæ–‡æ³•ç†è§£ãŒã‚ã‚‹å ´åˆã®å®Ÿè·µå•é¡Œé›†ã§ã™ã€‚' },
                        { name: 'é«˜æ ¡å…¥è©¦å¯¾ç­– è‡ªç”±è‹±ä½œæ–‡', publisher: 'ã‚¨ãƒ‡ãƒ¥ã‚±ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', reason: 'è‹±ä½œæ–‡ã®å®Œæˆåº¦ãŒæœ€çµ‚çš„ãªåˆ†å²ç‚¹ã¨ãªã‚Šã¾ã™ã€‚å‰¯æ•™æã¨ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„' },
                        { name: 'åƒè‘‰çœŒå…¥è©¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°', publisher: 'æ•™è‚²é–‹ç™ºå‡ºç‰ˆ', reason: 'å¿…å‹ã‚·ãƒªãƒ¼ã‚ºã¯ã€å„æ•™ç§‘ã”ã¨ã«ã‚ã‚Šã¾ã™ã€‚åƒè‘‰çœŒå…¥è©¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚ˆã‚Šã‚‚é›£æ˜“åº¦ãŒé«˜ã„ã§ã™ã€‚' },
                        { name: 'fãƒˆãƒ¬ãƒ»fãƒ†ã‚¹ãƒˆ', publisher: 'æ•™è‚²é–‹ç™ºå‡ºç‰ˆ', reason: 'æ¼”ç¿’é‡ã‚’ç¨¼ããŸã‚ã«ã€fãƒˆãƒ¬ã‚«fãƒ†ã‚¹ãƒˆã‚‚æœ‰åŠ¹ã§ã™ã€‚ãŸã ã€åƒè‘‰çœŒã«ç‰¹åŒ–ã—ã¦ã„ãªã„ãŸã‚ã€æ¼”ç¿’é‡ã‚’ç¨¼ãã¨ã„ã†æ„Ÿè¦šã§ä½¿ç”¨ã—ã¦ãã ã•ã„' }
                    ]
                },
            ],
            'æ•°å­¦': [
                {
                    condition: (current, target) => current <= 50 && target <= 50,
                    books: [
                        { name: 'ç²¾é¸å…¨å›½é«˜æ ¡å…¥è©¦å•é¡Œé›† è¨ˆç®—ãƒ»ä¸€è¡Œå•é¡Œé›†', publisher: 'ã‚¨ãƒ‡ãƒ¥ã‚±ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', reason: 'åŸºç¤åŠ›ãŒè¶³ã‚Šã¦ã„ã¾ã›ã‚“ã€‚è¨ˆç®—åŠ›ã¯æ•°å­¦ã®ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ãŸã‚ã€è¨ˆç®—åŠ›å‘ä¸Šã‚’ç›®æŒ‡ã—ã¾ã™ã€‚' },
                        { name: 'ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ æ•°å­¦ä¸€è¡Œå•é¡Œ 1000å•ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°', publisher: 'æ–‡ç†', reason: 'å•é¡Œæ•°ãŒå¤šãã€æ¼”ç¿’ãŒå¤šãã§ãã¾ã™ã€‚ãŸã ã€å‹‰å¼·ã«å‰å‘ãã§ã¯ãªã„ç”Ÿå¾’ã«ã¤ã„ã¦ã¯ã€æ„æ¬²ã‚’å‰²ãå¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ãŠã™ã™ã‚ã§ãã¾ã›ã‚“' },
                        { name: 'ã‚¦ã‚§ã‚¤ãƒ»ã‚¢ãƒƒãƒ— é«˜æ ¡å…¥è©¦å¯¾ç­–', publisher: 'ã‚¨ãƒ‡ãƒ¥ã‚±ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', reason: 'åŸºç¤ãƒ¬ãƒ™ãƒ«ã‚’ç¶²ç¾…çš„ã«å­¦ç¿’ã§ãã¾ã™ã€‚äºˆæƒ³å•é¡Œã‚„éå»å•å‰ã®ãƒ†ã‚­ã‚¹ãƒˆã«æœ€é©ã§ã™' },
                        { name: 'å¿…å‹ã‚·ãƒªãƒ¼ã‚ºåƒè‘‰çœŒç‰ˆ', publisher: 'æ—¥æœ¬æ•™æå‡ºç‰ˆ', reason: 'å„æ•™ç§‘ã”ã¨ã«ã‚ã‚Šã¾ã™ã€‚éå»å•ã®å‰ã«æ¼”ç¿’ã‚’è¡Œã†ã“ã¨ã§ã€éå»å•ã¸ã®å…ç–«ã‚’ã¤ã‘ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚' }
                    ]
                },
                {
                    condition: (current, target) => current > 50 && target >= 51,
                    books: [
                        { name: 'ãƒ•ã‚©ãƒ¬ã‚¹ã‚¿ã‚´ãƒ¼ãƒ«', publisher: 'ã‚¹ãƒ—ãƒªãƒƒã‚¯ã‚¹', reason: 'å¾ŒåŠã«ã¯ã‹ãªã‚Šé›£å•ã‚‚å¤šãã€å¾—ç‚¹ç‡å‘ä¸Šã«å½¹ç«‹ã¡ã¾ã™' },
                        { name: 'åƒè‘‰çœŒå…¥è©¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°', publisher: 'æ•™è‚²é–‹ç™ºå‡ºç‰ˆ', reason: 'å¿…å‹ã‚·ãƒªãƒ¼ã‚ºã¯ã€å„æ•™ç§‘ã”ã¨ã«ã‚ã‚Šã¾ã™ã€‚åƒè‘‰çœŒå…¥è©¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚ˆã‚Šã‚‚é›£æ˜“åº¦ãŒé«˜ã„ã§ã™ã€‚' },
                        { name: 'fãƒˆãƒ¬ãƒ»fãƒ†ã‚¹ãƒˆ', publisher: 'æ—¥æœ¬æ•™è‚²é–‹ç™ºå‡ºç‰ˆ', reason: 'æ¼”ç¿’é‡ã‚’ç¨¼ããŸã‚ã«ã€fãƒˆãƒ¬ã‚«fãƒ†ã‚¹ãƒˆã‚‚æœ‰åŠ¹ã§ã™ã€‚ãŸã ã€åƒè‘‰çœŒã«ç‰¹åŒ–ã—ã¦ã„ãªã„ãŸã‚ã€æ¼”ç¿’é‡ã‚’ç¨¼ãã¨ã„ã†æ„Ÿè¦šã§ä½¿ç”¨ã—ã¦ãã ã•ã„' }
                    ]
                }
            ],
            'å›½èª': [
                {
                    condition: (current, target) => current <= 50 && target <= 50,
                    books: [
                        { name: 'æ¼¢æ¤œæ¼¢å­—å­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—3ç´š', publisher: '', reason: 'åŸºç¤çš„ãªèªå½™åŠ›ãŒæ¬ å¦‚ã—ã¦ã„ã¾ã™ã€‚å—é¨“ç¯„å›²ã§ã‚ã‚‹æ¼¢æ¤œ3ç´šã‚’å­¦ã¶ã“ã¨ã§ã€èª­è§£åŠ›ã®åŸºç¤ã¨ãªã‚‹èªå½™åŠ›ã‚’è£œã„ã¾ã™ã€‚ãªãŠã€ç”»æ•°ã¯å®Ÿæ–½ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“' },
                        { name: 'ã‚¦ã‚§ã‚¤ãƒ»ã‚¢ãƒƒãƒ— é«˜æ ¡å…¥è©¦å¯¾ç­–', publisher: 'ã‚¨ãƒ‡ãƒ¥ã‚±ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', reason: 'åŸºç¤ãƒ¬ãƒ™ãƒ«ã‚’ç¶²ç¾…çš„ã«å­¦ç¿’ã§ãã¾ã™ã€‚äºˆæƒ³å•é¡Œã‚„éå»å•å‰ã®ãƒ†ã‚­ã‚¹ãƒˆã«æœ€é©ã§ã™' },
                        { name: 'èª­è§£ï¼å›½èªå…¥è©¦åŠ›-å¿…ä¿®ç·¨-', publisher: 'å­¦æ›¸', reason: 'åŸºç¤ãƒ¬ãƒ™ãƒ«èª­è§£æ¼”ç¿’ãŒã§ãã¾ã™ã€‚åˆ†é‡ãŒå°‘ãªã„ã‚‚ã®ã®ã€æ¼”ç¿’é‡ã‚’ç¨¼ãã“ã¨ã§ã€èª­è§£åŠ›ã®åº•ä¸Šã’ã‚’ç›®æŒ‡ã—ã¾ã™' },
                        { name: 'èª­è§£ï¼å›½èªå…¥è©¦åŠ›-å®Ÿè·µç·¨-', publisher: 'å­¦æ›¸', reason: 'ç™ºå±•ã¾ã§ã¯ã„ãã¾ã›ã‚“ãŒã€æ¨™æº–ä»¥ä¸Šã®èª­è§£æ¼”ç¿’ãŒã§ãã¾ã™ã€‚' },
                        { name: 'ä½œæ–‡å¯¾ç­–', publisher: 'æ•™è‚²é–‹ç™ºå‡ºç‰ˆ', reason: 'ãŸã„ã¦ã„ã®ãƒ†ã‚­ã‚¹ãƒˆã«ã‚‚ä½œæ–‡å¯¾ç­–ã¯ã¤ã„ã¦ã„ã¾ã™ãŒã€ä½œæ–‡æ•™ç§‘ç”¨ã®ãƒ†ã‚­ã‚¹ãƒˆã§ã™ã€‚ä½œæ–‡ã®é…ç‚¹ãŒé«˜ã„ãŸã‚ã€å¯¾ç­–ã¯å¤–ã›ã¾ã›ã‚“' },
                        { name: 'å¿…å‹ã‚·ãƒªãƒ¼ã‚ºåƒè‘‰çœŒç‰ˆ', publisher: 'æ—¥æœ¬æ•™æå‡ºç‰ˆ', reason: 'å„æ•™ç§‘ã”ã¨ã«ã‚ã‚Šã¾ã™ã€‚éå»å•ã®å‰ã«æ¼”ç¿’ã‚’è¡Œã†ã“ã¨ã§ã€éå»å•ã¸ã®å…ç–«ã‚’ã¤ã‘ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚' }
                    ]
                },

                {
                    condition: (current, target) => current > 50 && target >= 51,
                    books: [
                        { name: 'BUILDER å—é¨“ç‰ˆ', publisher: 'å­¦æ›¸', reason: 'èª­è§£æ¼”ç¿’ã«ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚åƒè‘‰çœŒã§ã¯å‡ºé¡Œã•ã‚Œãªã„è©©ãƒ»çŸ­æ­Œãƒ»ä¿³å¥ã¯å®Ÿæ–½ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚' },
                        { name: 'åƒè‘‰çœŒå…¥è©¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°', publisher: 'æ•™è‚²é–‹ç™ºå‡ºç‰ˆ', reason: 'å¿…å‹ã‚·ãƒªãƒ¼ã‚ºã¯ã€å„æ•™ç§‘ã”ã¨ã«ã‚ã‚Šã¾ã™ã€‚åƒè‘‰çœŒå…¥è©¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚ˆã‚Šã‚‚é›£æ˜“åº¦ãŒé«˜ã„ã§ã™ã€‚' },
                        { name: 'fãƒˆãƒ¬ãƒ»fãƒ†ã‚¹ãƒˆ', publisher: 'æ—¥æœ¬æ•™è‚²é–‹ç™ºå‡ºç‰ˆ/æ•™è‚²é–‹ç™ºå‡ºç‰ˆ', reason: 'æ¼”ç¿’é‡ã‚’ç¨¼ããŸã‚ã«ã€fãƒˆãƒ¬ã‚«fãƒ†ã‚¹ãƒˆã‚‚æœ‰åŠ¹ã§ã™ã€‚ãŸã ã€åƒè‘‰çœŒã«ç‰¹åŒ–ã—ã¦ã„ãªã„ãŸã‚ã€æ¼”ç¿’é‡ã‚’ç¨¼ãã¨ã„ã†æ„Ÿè¦šã§ä½¿ç”¨ã—ã¦ãã ã•ã„' }
                    ]
                }
            ],
            'ç†ç§‘': [
                {
                    condition: (current, target) =>current  <= 50 && target <= 50,
                    books: [
                        { name: 'ç²¾é¸ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ä¸­3', publisher: 'ã‚¨ãƒ‡ãƒ¥ã‚±ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', reason: 'é€šå¸¸æˆæ¥­ç”¨ã¨ã—ã¦ã‚‚åˆ©ç”¨ãŒã§ãã¾ã™ãŒã€å…¨å­¦å¹´ã®å¾©ç¿’ãŒå…¥ã£ã¦ãŠã‚Šã€ãƒ‰ãƒªãƒ«å¼ã®å­¦ç¿’ã®ãŸã‚ã€å–ã‚Šçµ„ã¿ã‚„ã™ã„ç‰¹å¾´ãŒã‚ã‚Šã¾ã™' },
                        { name: 'ã‚¦ã‚§ã‚¤ãƒ»ã‚¢ãƒƒãƒ— é«˜æ ¡å…¥è©¦å¯¾ç­–', publisher: 'ã‚¨ãƒ‡ãƒ¥ã‚±ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', reason: 'åŸºç¤ãƒ¬ãƒ™ãƒ«ã‚’ç¶²ç¾…çš„ã«å­¦ç¿’ã§ãã¾ã™ã€‚äºˆæƒ³å•é¡Œã‚„éå»å•å‰ã®ãƒ†ã‚­ã‚¹ãƒˆã«æœ€é©ã§ã™' },
                        { name: 'å¿…å‹ã‚·ãƒªãƒ¼ã‚ºåƒè‘‰çœŒç‰ˆ', publisher: 'æ—¥æœ¬æ•™æå‡ºç‰ˆ', reason: 'å„æ•™ç§‘ã”ã¨ã«ã‚ã‚Šã¾ã™ã€‚éå»å•ã®å‰ã«æ¼”ç¿’ã‚’è¡Œã†ã“ã¨ã§ã€éå»å•ã¸ã®å…ç–«ã‚’ã¤ã‘ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚' }
                    ]
                },
                {
                    condition: (current, target) => current > 50 && target > 50,
                    books: [
                        { name: 'ãƒ•ã‚©ãƒ¬ã‚¹ã‚¿ã‚´ãƒ¼ãƒ«', publisher: 'ã‚¹ãƒ—ãƒªãƒƒã‚¯ã‚¹', reason: 'ç¶²ç¾…çš„ã«å­¦ç¿’ãŒã§ãã€äºˆæƒ³å•é¡Œã®å…¨æ®µéšã¨ã—ã¦æœ‰åŠ¹ã§ã™ã€‚ãŸã ã€ä»–ã®å¼·åŒ–ã‚’åœ§è¿«ã™ã‚‹å ´åˆã¯ã€ä½¿ç”¨ã‚’é¿ã‘ãŸã»ã†ãŒè‰¯ã„ã§ã™' },
                        { name: 'å¿…å‹ã‚·ãƒªãƒ¼ã‚ºåƒè‘‰çœŒç‰ˆ', publisher: 'æ—¥æœ¬æ•™æå‡ºç‰ˆ', reason: 'åŸºç¤çš„ãªå•é¡ŒãŒå¤šã„å‚¾å‘ãŒã‚ã‚Šã¾ã™ãŒã€å…¥è©¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«å…¥ã‚‹å‰ã®æº–å‚™ã¨ã—ã¦å®Ÿæ–½ã—ã¾ã™' },
                        { name: 'åƒè‘‰çœŒå…¥è©¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°', publisher: 'æ•™è‚²é–‹ç™ºå‡ºç‰ˆ', reason: 'å¿…å‹ã‚·ãƒªãƒ¼ã‚ºã¯ã€å„æ•™ç§‘ã”ã¨ã«ã‚ã‚Šã¾ã™ã€‚åƒè‘‰çœŒå…¥è©¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚ˆã‚Šã‚‚é›£æ˜“åº¦ãŒé«˜ã„ã§ã™ã€‚' },
                        { name: 'fãƒˆãƒ¬ãƒ»fãƒ†ã‚¹ãƒˆ', publisher: 'æ—¥æœ¬æ•™è‚²é–‹ç™ºå‡ºç‰ˆ', reason: 'æ¼”ç¿’é‡ã‚’ç¨¼ããŸã‚ã«ã€fãƒˆãƒ¬ã‚«fãƒ†ã‚¹ãƒˆã‚‚æœ‰åŠ¹ã§ã™ã€‚ãŸã ã€åƒè‘‰çœŒã«ç‰¹åŒ–ã—ã¦ã„ãªã„ãŸã‚ã€æ¼”ç¿’é‡ã‚’ç¨¼ãã¨ã„ã†æ„Ÿè¦šã§ä½¿ç”¨ã—ã¦ãã ã•ã„' }
                    ]
                }
            ],
            'ç¤¾ä¼š': [
                {
                    condition: (current, target) => current <= 50 && target <= 50,
                    books: [
                        { name: 'ç²¾é¸ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ­´å²ãƒ»åœ°ç†ãƒ»ä¸­3', publisher: 'ã‚¨ãƒ‡ãƒ¥ã‚±ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', reason: 'é€šå¸¸æˆæ¥­ç”¨ã¨ã—ã¦ã‚‚åˆ©ç”¨ãŒã§ãã¾ã™ãŒã€å…¨å­¦å¹´ã®å¾©ç¿’ãŒå…¥ã£ã¦ãŠã‚Šã€ãƒ‰ãƒªãƒ«å¼ã®å­¦ç¿’ã®ãŸã‚ã€å–ã‚Šçµ„ã¿ã‚„ã™ã„ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚åœ°ç†ã¨æ­´å²ã¨ä¸­3ã§åˆ¥å†Šã¨ãªã£ã¦ã„ã¾ã™ã€‚' },
                        { name: 'ã‚¦ã‚§ã‚¤ãƒ»ã‚¢ãƒƒãƒ— é«˜æ ¡å…¥è©¦å¯¾ç­–', publisher: 'ã‚¨ãƒ‡ãƒ¥ã‚±ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', reason: 'åŸºç¤ãƒ¬ãƒ™ãƒ«ã‚’ç¶²ç¾…çš„ã«å­¦ç¿’ã§ãã¾ã™ã€‚äºˆæƒ³å•é¡Œã‚„éå»å•å‰ã®ãƒ†ã‚­ã‚¹ãƒˆã«æœ€é©ã§ã™' },
                        { name: 'å¿…å‹ã‚·ãƒªãƒ¼ã‚ºåƒè‘‰çœŒç‰ˆ', publisher: 'æ—¥æœ¬æ•™æå‡ºç‰ˆ', reason: 'å„æ•™ç§‘ã”ã¨ã«ã‚ã‚Šã¾ã™ã€‚éå»å•ã®å‰ã«æ¼”ç¿’ã‚’è¡Œã†ã“ã¨ã§ã€éå»å•ã¸ã®å…ç–«ã‚’ã¤ã‘ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚' }
                    ]
                },
                {
                    condition: (current, target) => current > 50 && target > 50,
                    books: [
                        { name: 'ãƒ•ã‚©ãƒ¬ã‚¹ã‚¿ã‚´ãƒ¼ãƒ«', publisher: 'ã‚¹ãƒ—ãƒªãƒƒã‚¯ã‚¹', reason: 'ç¶²ç¾…çš„ã«å­¦ç¿’ãŒã§ãã€äºˆæƒ³å•é¡Œã®å…¨æ®µéšã¨ã—ã¦æœ‰åŠ¹ã§ã™ã€‚ãŸã ã€ä»–ã®å¼·åŒ–ã‚’åœ§è¿«ã™ã‚‹å ´åˆã¯ã€ä½¿ç”¨ã‚’é¿ã‘ãŸã»ã†ãŒè‰¯ã„ã§ã™' },
                        { name: 'å¿…å‹ã‚·ãƒªãƒ¼ã‚ºåƒè‘‰çœŒç‰ˆ', publisher: 'æ—¥æœ¬æ•™æå‡ºç‰ˆ', reason: 'åŸºç¤çš„ãªå•é¡ŒãŒå¤šã„å‚¾å‘ãŒã‚ã‚Šã¾ã™ãŒã€å…¥è©¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«å…¥ã‚‹å‰ã®æº–å‚™ã¨ã—ã¦å®Ÿæ–½ã—ã¾ã™' },
                        { name: 'åƒè‘‰çœŒå…¥è©¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°', publisher: 'æ•™è‚²é–‹ç™ºå‡ºç‰ˆ', reason: 'å¿…å‹ã‚·ãƒªãƒ¼ã‚ºã¯ã€å„æ•™ç§‘ã”ã¨ã«ã‚ã‚Šã¾ã™ã€‚åƒè‘‰çœŒå…¥è©¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚ˆã‚Šã‚‚é›£æ˜“åº¦ãŒé«˜ã„ã§ã™ã€‚' },
                        { name: 'fãƒˆãƒ¬ãƒ»fãƒ†ã‚¹ãƒˆ', publisher: 'æ•™è‚²é–‹ç™ºå‡ºç‰ˆ', reason: 'æ¼”ç¿’é‡ã‚’ç¨¼ããŸã‚ã«ã€fãƒˆãƒ¬ã‚«fãƒ†ã‚¹ãƒˆã‚‚æœ‰åŠ¹ã§ã™ã€‚ãŸã ã€åƒè‘‰çœŒã«ç‰¹åŒ–ã—ã¦ã„ãªã„ãŸã‚ã€æ¼”ç¿’é‡ã‚’ç¨¼ãã¨ã„ã†æ„Ÿè¦šã§ä½¿ç”¨ã—ã¦ãã ã•ã„' }
                    ]
                }
            ]
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let expandedBook = null;
        let selectedSchoolData = null;

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        document.addEventListener('DOMContentLoaded', function() {
            // åå·®å€¤å…¥åŠ›ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            document.querySelectorAll('.score-input').forEach(input => {
                input.addEventListener('input', function() {
                    validateScore(this);
                    updateNaishin();
                });
                input.addEventListener('blur', function() {
                    validateScore(this);
                });
            });

            // å†…ç”³ç‚¹å…¥åŠ›ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            document.querySelectorAll('.naishin-input').forEach(input => {
                input.addEventListener('input', function() {
                    validateNaishin(this);
                    updateNaishin();
                });
                input.addEventListener('blur', function() {
                    validateNaishin(this);
                });
            });

            // å­¦ç§‘é¸æŠã®ç›£è¦–
            document.getElementById('schoolType').addEventListener('change', handleSchoolTypeChange);

            // å­¦åŒºé¸æŠã®ç›£è¦–
            document.getElementById('studentDistrict').addEventListener('change', handleDistrictChange);

            // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
            document.getElementById('mainForm').addEventListener('submit', handleSubmit);
        });

        // åå·®å€¤ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        function validateScore(input) {
            const value = parseFloat(input.value);
            const errorDiv = input.parentElement.querySelector('.error-message');
            
            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãªã„å ´åˆã¯ä½œæˆ
            if (!errorDiv) {
                const newErrorDiv = document.createElement('div');
                newErrorDiv.className = 'error-message';
                input.parentElement.appendChild(newErrorDiv);
            }
            
            const errorElement = input.parentElement.querySelector('.error-message');
            
            if (input.value === '') {
                input.classList.remove('error');
                errorElement.classList.remove('show');
                errorElement.textContent = '';
                return true;
            }
            
            if (isNaN(value) || value < 0 || value > 100) {
                input.classList.add('error');
                errorElement.classList.add('show');
                errorElement.textContent = 'åå·®å€¤ã¯0ï½100ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„';
                return false;
            }
            
            input.classList.remove('error');
            errorElement.classList.remove('show');
            errorElement.textContent = '';
            return true;
        }

        // å†…ç”³ç‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        function validateNaishin(input) {
            const value = parseInt(input.value);
            const errorDiv = input.parentElement.querySelector('.error-message');
            
            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãªã„å ´åˆã¯ä½œæˆ
            if (!errorDiv) {
                const newErrorDiv = document.createElement('div');
                newErrorDiv.className = 'error-message';
                input.parentElement.appendChild(newErrorDiv);
            }
            
            const errorElement = input.parentElement.querySelector('.error-message');
            
            if (input.value === '') {
                input.classList.remove('error');
                errorElement.classList.remove('show');
                errorElement.textContent = '';
                return true;
            }
            
            if (isNaN(value) || value < 0 || value > 45) {
                input.classList.add('error');
                errorElement.classList.add('show');
                errorElement.textContent = 'å†…ç”³ç‚¹ã¯0ï½45ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„';
                return false;
            }
            
            input.classList.remove('error');
            errorElement.classList.remove('show');
            errorElement.textContent = '';
            return true;
        }

        // å†…ç”³ç‚¹åˆè¨ˆã®è¨ˆç®—ã¨è¡¨ç¤º
        function updateNaishin() {
            const grade1 = parseInt(document.getElementById('grade1').value) || 0;
            const grade2 = parseInt(document.getElementById('grade2').value) || 0;
            const grade3 = parseInt(document.getElementById('grade3').value) || 0;
            const total = grade1 + grade2 + grade3;

            if (total > 0) {
                document.getElementById('totalNaishin').textContent = total;
                document.getElementById('naishinDisplay').classList.remove('hidden');
            } else {
                document.getElementById('naishinDisplay').classList.add('hidden');
            }
        }

        // å­¦ç§‘é¸æŠæ™‚ã®å‡¦ç†
        function handleSchoolTypeChange() {
            const schoolType = document.getElementById('schoolType').value;
            const districtSelect = document.getElementById('districtSelect');
            const schoolSelect = document.getElementById('schoolSelect');

            if (schoolType === 'normal') {
                districtSelect.classList.remove('hidden');
                schoolSelect.classList.add('hidden');
            } else if (schoolType === 'specialized') {
                districtSelect.classList.add('hidden');
                updateSchoolList();
                schoolSelect.classList.remove('hidden');
            } else {
                districtSelect.classList.add('hidden');
                schoolSelect.classList.add('hidden');
            }
        }

        // å­¦åŒºé¸æŠæ™‚ã®å‡¦ç†
        function handleDistrictChange() {
            updateSchoolList();
            document.getElementById('schoolSelect').classList.remove('hidden');
        }

        // å¿—æœ›æ ¡ãƒªã‚¹ãƒˆã®æ›´æ–°
        function updateSchoolList() {
            const schoolType = document.getElementById('schoolType').value;
            const district = document.getElementById('studentDistrict').value;
            const targetSchoolSelect = document.getElementById('targetSchool');

            targetSchoolSelect.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';

            let schools = [];

            if (schoolType === 'specialized') {
                schools = chibaHighSchools.specialized;
            } else if (schoolType === 'normal' && district) {
                const districtNum = parseInt(district);
                schools = [...(chibaHighSchools[`district${districtNum}`]?.æ™®é€šç§‘ || [])];

                // éš£æ¥å­¦åŒºã®é«˜æ ¡ã‚‚è¿½åŠ 
                const adjacent = adjacentDistricts[districtNum] || [];
                adjacent.forEach(adjDistrict => {
                    const adjSchools = chibaHighSchools[`district${adjDistrict}`]?.æ™®é€šç§‘ || [];
                    schools.push(...adjSchools);
                });

                schools.sort((a, b) => b.hensachi - a.hensachi);
            }

            schools.forEach(school => {
                const option = document.createElement('option');
                option.value = JSON.stringify(school);
                option.textContent = `${school.name} (åå·®å€¤ç›®å®‰: ${school.hensachi})`;
                targetSchoolSelect.appendChild(option);
            });
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
        function handleSubmit(e) {
            e.preventDefault();

            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯
            let isValid = true;
            
            // åå·®å€¤ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            document.querySelectorAll('.score-input').forEach(input => {
                if (!validateScore(input)) {
                    isValid = false;
                }
            });
            
            // å†…ç”³ç‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            document.querySelectorAll('.naishin-input').forEach(input => {
                if (!validateNaishin(input)) {
                    isValid = false;
                }
            });
            
            if (!isValid) {
                alert('å…¥åŠ›ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚èµ¤è‰²ã§è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹é …ç›®ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const targetSchoolValue = document.getElementById('targetSchool').value;
            if (!targetSchoolValue) {
                alert('å¿—æœ›æ ¡ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const studentName = document.getElementById('studentName').value;
            if (!studentName) {
                alert('ç”Ÿå¾’åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            selectedSchoolData = JSON.parse(targetSchoolValue);
            displayResults();
        }

        // Excelå‡ºåŠ›æ©Ÿèƒ½
        function exportToExcel() {
            const studentName = document.getElementById('studentName').value;
            const scores = {
                english: parseFloat(document.getElementById('english').value) || 0,
                math: parseFloat(document.getElementById('math').value) || 0,
                japanese: parseFloat(document.getElementById('japanese').value) || 0,
                science: parseFloat(document.getElementById('science').value) || 0,
                social: parseFloat(document.getElementById('social').value) || 0
            };
            const fiveSubject = parseFloat(document.getElementById('fiveSubjectHensachi').value) || 0;
            const grade1 = parseInt(document.getElementById('grade1').value) || 0;
            const grade2 = parseInt(document.getElementById('grade2').value) || 0;
            const grade3 = parseInt(document.getElementById('grade3').value) || 0;
            const totalNaishin = grade1 + grade2 + grade3;

            const validScores = Object.values(scores).filter(v => v > 0);
            const averageHensachi = validScores.length > 0 
                ? Math.round(validScores.reduce((a, b) => a + b, 0) / validScores.length)
                : 0;

            const targetHensachi = selectedSchoolData.hensachi;

            // CSVãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
            let csv = '\uFEFF'; // BOM for Excel UTF-8 support
            csv += 'åƒè‘‰çœŒå…¬ç«‹é«˜æ ¡å—é¨“å¯¾ç­–ãƒ†ã‚­ã‚¹ãƒˆè‡ªå‹•åˆ¤å®šçµæœ\n\n';
            
            csv += 'ã€ç”Ÿå¾’æƒ…å ±ã€‘\n';
            csv += `ç”Ÿå¾’å,${studentName}\n`;
            csv += `å¿—æœ›æ ¡,${selectedSchoolData.name}\n`;
            csv += `å¿—æœ›æ ¡åå·®å€¤,${targetHensachi}\n\n`;

            csv += 'ã€æˆç¸¾æƒ…å ±ã€‘\n';
            csv += `è‹±èªåå·®å€¤,${scores.english || '-'}\n`;
            csv += `æ•°å­¦åå·®å€¤,${scores.math || '-'}\n`;
            csv += `å›½èªåå·®å€¤,${scores.japanese || '-'}\n`;
            csv += `ç†ç§‘åå·®å€¤,${scores.science || '-'}\n`;
            csv += `ç¤¾ä¼šåå·®å€¤,${scores.social || '-'}\n`;
            csv += `5æ•™ç§‘å¹³å‡åå·®å€¤,${averageHensachi}\n`;
            csv += `5æ•™ç§‘ç·åˆåå·®å€¤,${fiveSubject || '-'}\n\n`;

            csv += 'ã€å†…ç”³ç‚¹ã€‘\n';
            csv += `1å¹´ç”Ÿ,${grade1}\n`;
            csv += `2å¹´ç”Ÿ,${grade2}\n`;
            csv += `3å¹´ç”Ÿ,${grade3}\n`;
            csv += `åˆè¨ˆ,${totalNaishin}\n\n`;

            csv += 'ã€æ¨å¥¨ãƒ†ã‚­ã‚¹ãƒˆã€‘\n';
            
            const subjectNames = {
                english: 'è‹±èª',
                math: 'æ•°å­¦',
                japanese: 'å›½èª',
                science: 'ç†ç§‘',
                social: 'ç¤¾ä¼š'
            };

            Object.keys(subjectNames).forEach(subjectKey => {
                const currentScore = scores[subjectKey];
                if (!currentScore || currentScore === 0) return;

                const recommendations = getRecommendedTextbooks(subjectNames[subjectKey], currentScore, targetHensachi);
                if (recommendations.length === 0) return;

                csv += `\nã€${subjectNames[subjectKey]}ã€‘ï¼ˆç¾åœ¨:${currentScore} â†’ ç›®æ¨™:${targetHensachi}ï¼‰\n`;
                csv += 'ãƒ†ã‚­ã‚¹ãƒˆå,å‡ºç‰ˆç¤¾,å—è¬›ç†ç”±\n';

                recommendations.forEach(book => {
                    const name = book.name.replace(/,/g, 'ï¼Œ');
                    const publisher = (book.publisher || '').replace(/,/g, 'ï¼Œ');
                    const reason = book.reason.replace(/,/g, 'ï¼Œ').replace(/\n/g, ' ');
                    csv += `${name},${publisher},${reason}\n`;
                });
            });

            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            const timestamp = new Date().toISOString().slice(0, 10);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `æ¨å¥¨ãƒ†ã‚­ã‚¹ãƒˆ_${studentName}_${timestamp}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // çµæœè¡¨ç¤º
        function displayResults() {
            const scores = {
                english: parseFloat(document.getElementById('english').value) || 0,
                math: parseFloat(document.getElementById('math').value) || 0,
                japanese: parseFloat(document.getElementById('japanese').value) || 0,
                science: parseFloat(document.getElementById('science').value) || 0,
                social: parseFloat(document.getElementById('social').value) || 0
            };

            const validScores = Object.values(scores).filter(v => v > 0);
            const averageHensachi = validScores.length > 0 
                ? Math.round(validScores.reduce((a, b) => a + b, 0) / validScores.length)
                : 0;

            const targetHensachi = selectedSchoolData.hensachi;
            const gap = targetHensachi - averageHensachi;

            // çµ±è¨ˆè¡¨ç¤º
            document.getElementById('currentHensachi').textContent = averageHensachi;
            document.getElementById('targetHensachi').textContent = targetHensachi;
            document.getElementById('targetSchoolName').textContent = selectedSchoolData.name;
            document.getElementById('gapHensachi').textContent = gap >= 0 ? '+' + gap : gap;

            // åå·®å€¤Â±3ã®é«˜æ ¡è¡¨ç¤º
            displayNearbySchools(averageHensachi);

            // æ¨å¥¨ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
            displayTextbooks(scores, targetHensachi);

            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’éè¡¨ç¤ºã«ã—ã¦çµæœã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
            document.querySelector('.form-area').classList.add('hidden');
            document.getElementById('resultsArea').classList.remove('hidden');
            
            // ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // å…¥åŠ›ç”»é¢ã«æˆ»ã‚‹
        function backToForm() {
            document.querySelector('.form-area').classList.remove('hidden');
            document.getElementById('resultsArea').classList.add('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // åå·®å€¤Â±3ã®é«˜æ ¡è¡¨ç¤º
        function displayNearbySchools(averageHensachi) {
            const allSchools = [
                ...(chibaHighSchools.district1.æ™®é€šç§‘ || []),
                ...(chibaHighSchools.district2.æ™®é€šç§‘ || []),
                ...(chibaHighSchools.district3.æ™®é€šç§‘ || []),
                ...(chibaHighSchools.district4.æ™®é€šç§‘ || []),
                ...(chibaHighSchools.district5.æ™®é€šç§‘ || []),
                ...(chibaHighSchools.district6.æ™®é€šç§‘ || []),
                ...(chibaHighSchools.district7.æ™®é€šç§‘ || []),
                ...(chibaHighSchools.district8.æ™®é€šç§‘ || []),
                ...(chibaHighSchools.district9.æ™®é€šç§‘ || []),
                ...chibaHighSchools.specialized
            ];

            const nearbySchools = allSchools
                .filter(school => Math.abs(school.hensachi - averageHensachi) <= 3)
                .sort((a, b) => b.hensachi - a.hensachi);

            if (nearbySchools.length > 0) {
                const listHtml = nearbySchools
                    .map(school => `<span class="school-badge">${school.name} (åå·®å€¤ ${school.hensachi})</span>`)
                    .join('');
                document.getElementById('nearbySchoolsList').innerHTML = listHtml;
                document.getElementById('nearbySchoolsCard').classList.remove('hidden');
            } else {
                document.getElementById('nearbySchoolsCard').classList.add('hidden');
            }
        }

        // æ¨å¥¨ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
        function displayTextbooks(scores, targetHensachi) {
            const subjectNames = {
                english: 'è‹±èª',
                math: 'æ•°å­¦',
                japanese: 'å›½èª',
                science: 'ç†ç§‘',
                social: 'ç¤¾ä¼š'
            };

            let html = '';

            Object.keys(subjectNames).forEach(subjectKey => {
                const currentScore = scores[subjectKey];
                if (!currentScore || currentScore === 0) return;

                const recommendations = getRecommendedTextbooks(subjectNames[subjectKey], currentScore, targetHensachi);
                if (recommendations.length === 0) return;

                html += `
                    <div class="subject-section">
                        <h3 class="subject-title">
                            â–¶ ${subjectNames[subjectKey]}
                            <span style="font-size: 14px; color: #718096; font-weight: 400;">
                                ï¼ˆç¾åœ¨: ${currentScore} â†’ ç›®æ¨™: ${targetHensachi}ï¼‰
                            </span>
                        </h3>
                `;

                recommendations.forEach((book, index) => {
                    const bookId = `${subjectKey}-${index}`;
                    html += `
                        <div>
                            <div class="textbook-card" onclick="toggleBookDetail('${bookId}')">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-size: 16px; font-weight: 700; color: #2d3748; margin-bottom: 4px;">
                                            ${book.name}
                                        </div>
                                        ${book.publisher ? `<div style="font-size: 14px; color: #718096;">${book.publisher}</div>` : ''}
                                    </div>
                                    <div style="font-size: 12px; color: #667eea; font-weight: 700;" id="toggle-${bookId}">
                                        â–¶ è©³ç´°
                                    </div>
                                </div>
                            </div>
                            <div id="detail-${bookId}" class="textbook-detail hidden">
                                <div style="font-size: 13px; font-weight: 700; color: #2d3748; margin-bottom: 8px;">
                                    å—è¬›ç†ç”±ï¼š
                                </div>
                                <div style="font-size: 14px; color: #4a5568; line-height: 1.6;">
                                    ${book.reason}
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
            });

            document.getElementById('textbooksList').innerHTML = html || '<p>æ¨å¥¨ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p>';
        }

        // æ¨å¥¨ãƒ†ã‚­ã‚¹ãƒˆå–å¾—
        function getRecommendedTextbooks(subjectName, currentScore, targetScore) {
            const current = parseInt(currentScore) || 0;
            const target = parseInt(targetScore) || 0;

            const rules = textbookRules[subjectName] || [];
            const recommendations = [];

            rules.forEach(rule => {
                if (rule.condition(current, target)) {
                    recommendations.push(...rule.books);
                }
            });

            // é‡è¤‡ã‚’é™¤å»
            const uniqueBooks = [];
            const bookNames = new Set();
            recommendations.forEach(book => {
                if (!bookNames.has(book.name)) {
                    bookNames.add(book.name);
                    uniqueBooks.push(book);
                }
            });

            return uniqueBooks;
        }

        // ãƒ†ã‚­ã‚¹ãƒˆè©³ç´°ã®å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿
        function toggleBookDetail(bookId) {
            const detailElement = document.getElementById(`detail-${bookId}`);
            const toggleElement = document.getElementById(`toggle-${bookId}`);

            if (detailElement.classList.contains('hidden')) {
                detailElement.classList.remove('hidden');
                toggleElement.textContent = 'â–¼ é–‰ã˜ã‚‹';
            } else {
                detailElement.classList.add('hidden');
                toggleElement.textContent = 'â–¶ è©³ç´°';
            }
        }
    </script>
</body>
</html>
